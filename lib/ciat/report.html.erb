<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>CIAT Report</title>
		<link rel="stylesheet" href="ciat.css"/>
    <script src="prototype.js" type="text/javascript"></script>
	</head>
	
<%
def color_to_word(color)
	case color
	when "red" then "FAILURE"
	when "yellow" then "ERROR"
	when "green" then "passed"
	when "unset" then "n/a"
	end
end

def color_to_sentence(prefix, color)
	"<span class=\"#{color}\">#{prefix} " +
	case color
	when "red" then "failed"
	when "yellow" then "errored"
	when "green" then "passed"
	when "unset" then "not run"
	end +
	".</span>"
end

def replace_tabs(string)
	string.gsub("\t", "    ")
end
%>
	<body>
  	<h1>Summary Table</h1>
  	
  	<a href="#" onclick="$$('.results .result').invoke('toggle'); return false;">Expand/Collapse All</a>
  	
  	<table border="1" summary="Test summary" class="results">
  		<tr>
  			<th>Description</th>
  			<th>Compilation</th>
  			<th>Execution</th>
  		</tr>		
  		<% results.each do |result| %>
    		<tr>
    			<td><a href="#" onclick="$(this).up('tr').next().toggle(); return false;"><%= result.description %></a></td>
    			<td class="<%= result.compilation_light.color %>">
    				<%= color_to_word(result.compilation_light.color) %>
    			</td>
    			<td class="<%= result.execution_light.color %>">
    				<%= color_to_word(result.execution_light.color) %>
    			</td>
    		</tr>
    		<tr class="result" style="display:none">
    		  <td colspan="3">
        		<h3>Source</h3>
            <pre class="source"><%= replace_tabs(result.source) %></pre>

        		<h3>Target Code</h3>
            <table>
        	    <tr><th>Expected</th><th>Generated</th></tr>
              <%= replace_tabs(result.compilation_diff) %>
            </table>

        		<h3>Execution Output</h3>
            <% if result.compilation_light.green? %>
        		  <table>
        			  <tr><th>Expected</th><th>Generated</th></tr>
                <%= replace_tabs(result.output_diff) %>
              </table>
            <% else %>
              <p>No target code to execute...</p>
            <% end %>
          </td>
    		</tr>
  		<% end %>
  	</table>
	</body>
</html>
